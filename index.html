<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Checkout Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">
    
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        :root { --up: #e74c3c; --down: #27ae60; --p: #2c3e50; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); padding: 10px; display: flex; justify-content: center; margin: 0; }
        .box { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 8px 20px rgba(0,0,0,0.1); width: 100%; max-width: 450px; min-height: 95vh; }
        
        #reader { width: 100%; border-radius: 8px; overflow: hidden; margin-bottom: 10px; border: 2px solid #ddd; background: #000; }
        input { width: 100%; padding: 15px; border: 2px solid #eee; border-radius: 8px; font-size: 16px; margin-bottom: 10px; box-sizing: border-box; outline: none; }
        input:focus { border-color: #3498db; }
        
        .panel { padding: 15px; border-radius: 8px; margin-bottom: 15px; display: none; border-left: 5px solid #3498db; background: #ebf5fb; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; color: white; margin-bottom: 5px; }
        
        button { width: 100%; padding: 15px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; margin-bottom: 10px; transition: 0.2s; }
        button:active { transform: scale(0.98); }
        .btn-add { background: #27ae60; }
        .btn-scan { background: #3498db; }
        
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #eee; }
        .btn-del { background: none; color: var(--up); width: auto; padding: 5px; font-size: 18px; margin: 0; }
        
        .total { background: var(--p); color: white; padding: 15px; border-radius: 8px; text-align: center; margin-top: 20px; }
        .subtotal-preview { font-size: 18px; color: #27ae60; font-weight: bold; display: block; text-align: right; margin-bottom: 10px; }
    </style>
</head>
<body>

<div class="box">
    <h2 style="text-align: center; margin-top:0; color: var(--p);">üìä Smart Checkout Pro</h2>

    <div id="reader"></div>
    <button class="btn-scan" id="btn-camera" onclick="alternarCamera()">üì∏ Abrir Scanner</button>

    <input type="text" id="codigoInput" placeholder="Digite o c√≥digo ou escaneie..." oninput="verificar()">

    <div id="painel" class="panel">
        <span id="cat-exibicao" class="status-badge"></span><br>
        <b id="nome-exibicao" style="font-size: 18px;"></b>
        
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <div style="flex: 1;">
                <label style="font-size: 10px; font-weight: bold;">PRE√áO (R$)</label>
                <input type="number" id="preco-edit" step="0.01" oninput="calcularTudo()">
            </div>
            <div style="flex: 1;">
                <label style="font-size: 10px; font-weight: bold;">QTD / PESO</label>
                <input type="number" id="qtd-edit" value="1" step="0.001" oninput="calcularTudo()">
            </div>
        </div>

        <span class="subtotal-preview">Subtotal: R$ <span id="preview-val">0,00</span></span>
        <button class="btn-add" onclick="adicionar()">ADICIONAR √Ä LISTA</button>
    </div>

    <div id="lista"></div>

    <div class="total">
        TOTAL DA COMPRA: <h2 id="total-val" style="margin: 0; color: #2ecc71;">R$ 0,00</h2>
    </div>
</div>

<script>
    // Banco de Dados Completo (Unificado)
    const db = {
        "7898117961955": { n: "FLOC√ÉO MILHO", p: 0.98, c: "Mercearia" },
        "34559":         { n: "FLOC√ÉO MILHO", p: 0.98, c: "Mercearia" },
        "7898936732040": { n: "ARROZ GABRIELA 1KG", p: 2.99, c: "Mercearia" },
        "36365":         { n: "ARROZ GABRIELA 1KG", p: 2.99, c: "Mercearia" },
        "7898905239167": { n: "FEIJAO DA BARRA 1KG", p: 7.49, c: "Mercearia" },
        "22249":         { n: "FEIJAO DA BARRA 1KG", p: 7.49, c: "Mercearia" },
        "7897886900028": { n: "ACUCAR ALEGRE 1KG", p: 2.89, c: "Mercearia" },
        "7898230897667": { n: "MAC.BOM SABOR 400G", p: 1.98, c: "Mercearia" },
        "7896102502183": { n: "EXTRATO TOM.QUERO", p: 2.09, c: "Mercearia" },
        "7891091012026": { n: "CAFE NORDESTINO 250G", p: 12.99, c: "Mercearia" },
        "4019":          { n: "CAFE NORDESTINO 250G", p: 12.99, c: "Mercearia" },
        "7898403780925": { n: "CREME LEITE BETANIA", p: 3.39, c: "Latic√≠nios" },
        "7896292360433": { n: "MAIONESE PREDILECTA", p: 3.39, c: "Mercearia" },
        "7891107101621": { n: "OLEO SOJA SOYA 900ML", p: 9.99, c: "Mercearia" },
        "7894904271528": { n: "MARGARINA DELICIA 500G", p: 8.79, c: "Latic√≠nios" },
        "7891132000449": { n: "TEMP.SAZON 60G ARROZ", p: 5.49, c: "Mercearia" },
        "7891000285800": { n: "CALDO MAGGI 35G CARNE", p: 2.49, c: "Mercearia" },
        "7891132083022": { n: "TEMP.SAZON 40G FRANGO", p: 4.29, c: "Mercearia" },
        "7891021001946": { n: "FILTRO PAPEL MELITTA", p: 6.19, c: "Mercearia" },
        "7898943870285": { n: "OVOS GRANJA PRATA", p: 5.49, c: "Mercearia" },
        "7899055815478": { n: "CAMARAO MASTERBOI", p: 16.29, c: "Carnes" },
        "742832955621":  { n: "ALHO EMBALADO", p: 6.99, c: "Hortifruti" },
        "6":             { n: "BACON DEFUMADO KG", p: 38.29, c: "Carnes" },
        "63":            { n: "CEBOLA BRANCA KG", p: 3.98, c: "Hortifruti" },
        "60":            { n: "TOMATE KG", p: 4.18, c: "Hortifruti" }
    };

    const coresCategorias = { 
        "Mercearia": "#9b59b6", 
        "Latic√≠nios": "#3498db", 
        "Hortifruti": "#27ae60", 
        "Carnes": "#e67e22" 
    };

    let carrinho = [];
    let itemAtual = null;
    let html5QrCode = null;

    function verificar() {
        let busca = document.getElementById('codigoInput').value.trim();
        const painel = document.getElementById('painel');
        if (busca.length < 1) { painel.style.display = 'none'; return; }

        // Busca Inteligente: reconhece se o que voc√™ digitou est√° no banco
        let chaveEncontrada = Object.keys(db).find(key => key.includes(busca) || busca.includes(key));

        if (chaveEncontrada) {
            itemAtual = { ...db[chaveEncontrada], cod: chaveEncontrada };
            document.getElementById('nome-exibicao').innerText = itemAtual.n;
            document.getElementById('preco-edit').value = itemAtual.p;
            
            const badge = document.getElementById('cat-exibicao');
            badge.innerText = itemAtual.c;
            badge.style.backgroundColor = coresCategorias[itemAtual.c] || "#95a5a6";
            
            painel.style.display = 'block';
            calcularTudo();
        } else {
            painel.style.display = 'none';
        }
    }

    function calcularTudo() {
        const p = parseFloat(document.getElementById('preco-edit').value) || 0;
        const q = parseFloat(document.getElementById('qtd-edit').value) || 0;
        document.getElementById('preview-val').innerText = (p * q).toFixed(2).replace('.', ',');
    }

    function adicionar() {
        const p = parseFloat(document.getElementById('preco-edit').value);
        const q = parseFloat(document.getElementById('qtd-edit').value);
        if (isNaN(p) || q <= 0) return;

        carrinho.push({ id: Date.now(), nome: itemAtual.n, sub: p * q });
        renderizar();
        
        document.getElementById('codigoInput').value = "";
        document.getElementById('painel').style.display = 'none';
        document.getElementById('qtd-edit').value = "1";
    }

    function renderizar() {
        const lista = document.getElementById('lista');
        lista.innerHTML = "";
        let total = 0;
        carrinho.forEach(i => {
            total += i.sub;
            lista.innerHTML += `<div class="cart-item">
                <div><b>${i.nome}</b><br><small>R$ ${i.sub.toFixed(2).replace('.', ',')}</small></div>
                <button class="btn-del" onclick="apagar(${i.id})">üóëÔ∏è</button>
            </div>`;
        });
        document.getElementById('total-val').innerText = "R$ " + total.toFixed(2).replace('.', ',');
    }

    function apagar(id) {
        carrinho = carrinho.filter(i => i.id !== id);
        renderizar();
    }

    function alternarCamera() {
        if (!html5QrCode) html5QrCode = new Html5Qrcode("reader");
        
        if (html5QrCode.isScanning) {
            html5QrCode.stop().then(() => {
                document.getElementById('btn-camera').innerText = "üì∏ Abrir Scanner";
                document.getElementById('reader').style.border = "2px solid #ddd";
            });
        } else {
            html5QrCode.start(
                { facingMode: "environment" }, 
                { fps: 15, qrbox: { width: 250, height: 150 } }, 
                (text) => {
                    document.getElementById('codigoInput').value = text;
                    verificar();
                    if(navigator.vibrate) navigator.vibrate(100); // Vibra ao ler
                }
            ).catch(err => alert("Erro: Ative a c√¢mera ou use HTTPS."));
            document.getElementById('btn-camera').innerText = "üõë Parar Scanner";
            document.getElementById('reader').style.border = "2px solid #27ae60";
        }
    }
</script>
</body>
</html>
